# –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ò–ò

![Python](https://img.shields.io/badge/Python-3.11%2B-blue) ![License](https://img.shields.io/badge/License-MIT-lightgrey)

> **–ú–∞–≥–∏—Å—Ç–µ—Ä—Å–∫–∞—è –¥–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏—è, –£—Ä–∞–ª—å—Å–∫–∏–π —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç**
> –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: *–ò–Ω–∂–µ–Ω–µ—Ä–∏—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è*
> –ê–≤—Ç–æ—Ä: **–ê–∫–±—É–ª–∞—Ç–æ–≤ –ù—É—Ä–∏—Å–ª–∞–º –ú–∞—Ä—Å–µ–ª–µ–≤–∏—á**

---

## –û –ø—Ä–æ–µ–∫—Ç–µ

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç Telegram‚Äë–±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–Ω—ã—Ö (–≤ —Ç–æ–º —á–∏—Å–ª–µ —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö) –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

–ë–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏:

1. **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** ‚Äî —É–ª—É—á—à–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞—Å—Ç –∏ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç —à—É–º—ã, –Ω–µ –º–µ–Ω—è—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
2. **OCR** (Tesseract 5+) ‚Äî –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å —É—á—ë—Ç–æ–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏.
3. **–ü–æ—Å—Ç‚Äë–æ–±—Ä–∞–±–æ—Ç–∫–∞ GPT‚Äë4o** ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É.

> üìú **–ü–æ—á–µ–º—É –±–µ–∑ deskew/rotation?**
> –î–ª—è —Ö—Ä—É–ø–∫–∏—Ö –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è deskew‚Äë–∫–æ—Ä—Ä–µ–∫—Ü–∏—è —á–∞—Å—Ç–æ —É—Ö—É–¥—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ª–æ–º–∞–µ—Ç –¥–µ–ª–∏–∫–∞—Ç–Ω—É—é –∫–∞–ª–ª–∏–≥—Ä–∞—Ñ–∏—é. –ü–æ—ç—Ç–æ–º—É —É–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ –æ—Å—Ç–∞—ë—Ç—Å—è ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/<username>/<repo>.git && cd <repo>

# 2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv .venv && source .venv/bin/activate  # Windows: .venv\\Scripts\\activate

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
pip install -r requirements.txt

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Tesseract ‚â•‚ÄØ5.0 –≤–º–µ—Å—Ç–µ —Å —Ä—É—Å—Å–∫–æ–π –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–π –º–æ–¥–µ–ª—å—é
## Linux (deb‚Äëbased)
sudo apt update && \
  sudo apt install tesseract-ocr tesseract-ocr-language-data \
  tesseract-ocr-rus tesseract-ocr-eng
## macOS (Homebrew)
brew install tesseract-lang  # –≤–∫–ª—é—á–∞–µ—Ç eng –∏ rus
## Windows
# 1) –°–∫–∞—á–∞–π—Ç–µ –∏–Ω—Å—Ç–∞–ª–ª—è—Ç–æ—Ä —Å https://github.com/UB-Mannheim/tesseract/wiki
# 2) –í–æ –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ—Ç–º–µ—Ç—å—Ç–µ English –∏ Russian traineddata
#    (–∏–ª–∏ –ø–æ–∑–∂–µ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ rus.traineddata / eng.traineddata –≤ tessdata)

# 5. –î–æ–±–∞–≤—å—Ç–µ Tesseract –≤ PATH **–∏–ª–∏** —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –≤—Ä—É—á–Ω—É—é –≤ main.py
## –°–ø–æ—Å–æ–± A ‚Äî –¥–æ–±–∞–≤–∏—Ç—å PATH (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ)
#  Windows PowerShell (–ø—Ä–∏–º–µ—Ä)
setx PATH "%PATH%;C:\\Program Files\\Tesseract-OCR"
## –°–ø–æ—Å–æ–± B ‚Äî –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å main.py
#  _tesseract_path = r"C:\\Custom\\Path\\tesseract.exe"

# 6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –∏ –∑–∞–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω—ã
cp .env.example .env  # –∑–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ .env –∏ –≤–ø–∏—à–∏—Ç–µ TELEGRAM_TOKEN + OPENAI_API_KEY

# 7. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python main.py
```

> ‚ö†Ô∏è –ù–∞ Windows –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª, —á—Ç–æ–±—ã PATH –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è. –ï—Å–ª–∏ –ü–û —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
> –≤ –Ω–µ—Ç–∏–ø–∏—á–Ω—É—é –ø–∞–ø–∫—É, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ `_tesseract_path` (—Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ *main.py*).

–ë–æ—Ç –Ω–∞—á–Ω—ë—Ç ¬´—Å–ª—É—à–∞—Ç—å¬ª –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –í Telegram –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É üìÑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

* `/ocr` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç;
* `/ask <–≤–æ–ø—Ä–æ—Å>` ‚Äî —Å–ø—Ä–æ—Å–∏—Ç—å —á—Ç–æ‚Äë—É–≥–æ–¥–Ω–æ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è       | –û–ø–∏—Å–∞–Ω–∏–µ                        |
| ---------------- | ------------------------------- |
| `TELEGRAM_TOKEN` | –¢–æ–∫–µ–Ω BotFather                 |
| `OPENAI_API_KEY` | –ö–ª—é—á OpenAI —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ GPT‚Äë4o |

> –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ –æ—Ç–∫—Ä—ã—Ç—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* **Python** ‚â•‚ÄØ3.11
* [`opencv-python`](https://pypi.org/project/opencv-python/) ‚Äî –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞;
* [`pytesseract`](https://pypi.org/project/pytesseract/) + Tesseract ‚â•‚ÄØ5.0;
* [`python-telegram-bot` 21.x](https://docs.python-telegram-bot.org/) ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API Telegram;
* [`langchain`](https://python.langchain.com/) ‚Äî —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å LLM;
* –ø–æ–ª–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–º. `requirements.txt`.

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram    ‚îÇ  photo  ‚îÇ  Preprocess   ‚îÇ  img   ‚îÇ   Tesseract  ‚îÇ
‚îÇ    Client    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  (OpenCV)     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ    OCR       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                          ‚îÇ text
                                                          ‚ñº
                                                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                  ‚îÇ   GPT‚Äë4o     ‚îÇ
                                                  ‚îÇ  (Q&A)       ‚îÇ
                                                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

* **Preprocessing** (`preprocessing.py`): CLAHE, –±–∏–ª–∞—Ç–µ—Ä–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≥–∞—É—Å—Å–æ–≤ –ø–æ—Ä–æ–≥, –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è ¬´–∑–∞–ª–∏–≤–∫–∞¬ª.
* **OCR** (`image_to_text` –≤ `main.py`): Tesseract v5, —Ä—É—Å—Å–∫–æ‚Äë–∞–Ω–≥–ª–∏–π—Å–∫–∞—è –º–æ–¥–µ–ª—å (`--psm 6` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
* **LLM** (`ask_llm`): zero‚Äëtemperature, system‚Äëprompt —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç ¬´–æ—Ç–≤–µ—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞¬ª.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```text
.
‚îú‚îÄ‚îÄ main.py              # Telegram‚Äë–±–æ—Ç
‚îú‚îÄ‚îÄ preprocessing.py     # –ü–∞–π–ø–ª–∞–π–Ω –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ samples/             # –ü—Ä–∏–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îú‚îÄ‚îÄ temp/                # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (gitignored)
‚îú‚îÄ‚îÄ logs/                # –õ–æ–≥–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ (gitignored)
‚îú‚îÄ‚îÄ requirements.txt     # Python‚Äë–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example         # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md            # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–∏—à—É—Ç—Å—è –≤ `logs/bot.log` + –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ stdout, —á—Ç–æ–±—ã —É–¥–æ–±–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Docker/PM2.

---

## –ó–∞–ø—É—Å–∫ –≤ Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –°–±–æ—Ä–∫–∞
docker build -t archival-ocr .

# –ó–∞–ø—É—Å–∫ (Tesseract –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
docker run -e TELEGRAM_TOKEN=xxx -e OPENAI_API_KEY=yyy archival-ocr
```

> –£—á—Ç–∏—Ç–µ, —á—Ç–æ –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤–∞—à `tessdata`. –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∫–∞—Å—Ç–æ–º–Ω–∞—è —Ä—É—Å—Å–∫–∞—è/—Å—Ç–∞—Ä–æ—Å–ª–∞–≤—è–Ω—Å–∫–∞—è –º–æ–¥–µ–ª—å, —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ—ë —Ç–æ–º–æ–º.

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ TODO

* üìö **Dataset**: –ø—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–º–µ—â–µ–Ω—ã –≤ `samples/`, –Ω–æ –æ–±—É—á–∞—é—â–∏–π –Ω–∞–±–æ—Ä –Ω–µ –≤–∫–ª—é—á—ë–Ω –∏–∑‚Äë–∑–∞ –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
* üìù **Layout‚Äë–∞–Ω–∞–ª–∏–∑** —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.
* üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: —Å–µ–∫—Ä–µ—Ç—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è; —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ª–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π **MIT**. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ `LICENSE`.

---

> *¬´–ù–µ –≤—Å—è–∫–∏–π —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π —Ç–µ–∫—Å—Ç –ø–æ–¥–¥–∞—ë—Ç—Å—è OCR, –Ω–æ –∫–∞–∂–¥—ã–π –æ—Ü–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫—É–ª—å—Ç—É—Ä–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–∏—è¬ª.*
